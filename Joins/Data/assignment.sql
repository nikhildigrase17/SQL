USE DATABASE DEMO_DATABASE;

CREATE OR REPLACE TABLE ND_COMPLAINS
(
ID INT,
ComplainDate VARCHAR(10),
CompletionDate VARCHAR(10),
CustomerID INT,
BrokerID INT,
ProductID INT,
ComplainPriorityID INT,
ComplainTypeID INT,
ComplainSourceID INT,
ComplainCategoryID INT,
ComplainStatusID INT,
AdministratorID STRING,
ClientSatisfaction VARCHAR(10),
ExpectedReimbursement INT
);


CREATE OR REPLACE TABLE ND_BROKER
(
BrokerID INT,
BrokerCode VARCHAR(35),
BrokerFullName VARCHAR(35),
DistributionNetwork VARCHAR(35),
DistributionChannel VARCHAR(35),
CommissionScheme VARCHAR(35)
);


CREATE OR REPLACE TABLE ND_PRODUCTS
(
ProductID INT,
ProductCategory VARCHAR (35),
ProductSubCategory VARCHAR(50),
Product VARCHAR(20)
);


CREATE OR REPLACE TABLE ND_REGIONS
(
id INT,
name VARCHAR(50),
county VARCHAR(150),
state_code VARCHAR(5),
state VARCHAR(20),
type VARCHAR(25),
latitude INT,
longitude INT,
area_code INT,
population INT,
households INT,
median_income INT,
land_area INT,
water_area INT,
time_zone VARCHAR(50)
);



CREATE OR REPLACE TABLE ND_CUSTOMER
(
CustomerID	INT,
LastName VARCHAR(60),
FirstName VARCHAR(60),
BirthDate VARCHAR(20) ,
Gender VARCHAR(20),
ParticipantType	VARCHAR(20),
RegionID	INT,
MaritalStatus VARCHAR(15));


CREATE OR REPLACE TABLE ND_STATE_REGIONS
(
State_Code VARCHAR(6),
State VARCHAR(25),
Region VARCHAR(20)
);

CREATE OR REPLACE TABLE ND_PRIORITIES
(
ID INT,
Description VARCHAR(20)
);


CREATE OR REPLACE TABLE ND_STATUSES
(
ID INT,
Description VARCHAR(20)
);


CREATE OR REPLACE TABLE ND_CATEGORIES
(
ID INT,
Description VARCHAR(200),
Active INT
);


CREATE OR REPLACE TABLE ND_SOURCES
(
ID INT,
Description VARCHAR(25)
);


CREATE OR REPLACE TABLE ND_TYPES
(
ID INT,
Description VARCHAR(20)
);


CREATE OR REPLACE TABLE ND_STATUS_HISTORY_DATA
(
ID INT,
ComplaintID INT,
ComplaintStatusID INT,
StatusDate VARCHAR(10)
);

CREATE OR REPLACE TABLE ND_CUST_MASTER AS

SELECT C.ID,C.COMPLAINDATE,C.COMPLETIONDATE,CU.LASTNAME,CU.FIRSTNAME,CU.GENDER,B.BROKERFULLNAME,
B.COMMISSIONSCHEME,SR.REGION,CT.DESCRIPTION AS DESCRIPTION_CATEGORIES,PR.DESCRIPTION AS DESCRIPTION_PRIORITIES,
S.DESCRIPTION AS DESCRIPTION_STATUSES,SO.DESCRIPTION AS DESCRIPTION_SOURCES,T.DESCRIPTION AS DESCRIPTION_TYPES

FROM ND_COMPLAINS AS C
LEFT OUTER JOIN  ND_BROKER AS B ON C.BROKERID = B.BROKERID
LEFT OUTER JOIN ND_PRODUCTS AS P ON C.PRODUCTID = P.PRODUCTID
LEFT OUTER JOIN ND_CUSTOMER AS CU ON C.CUSTOMERID = CU.CUSTOMERID
LEFT OUTER JOIN ND_STATUS_HISTORY_DATA AS SHD ON C.COMPLAINSTATUSID = SHD.COMPLAINTSTATUSID
LEFT OUTER JOIN ND_REGIONS AS R ON CU.REGIONID = R.ID
LEFT OUTER JOIN ND_STATE_REGIONS AS SR ON R.STATE_CODE = SR.STATE_CODE
LEFT OUTER JOIN ND_PRIORITIES AS PR ON C.COMPLAINPRIORITYID = PR.ID
LEFT OUTER JOIN ND_STATUSES AS S ON C.COMPLAINSTATUSID = S.ID
LEFT OUTER JOIN ND_CATEGORIES AS CT ON C.COMPLAINCATEGORYID = CT.ID
LEFT OUTER JOIN ND_SOURCES AS SO ON C.COMPLAINSOURCEID = SO.ID
LEFT OUTER JOIN ND_TYPES AS T ON C.COMPLAINTYPEID = T.ID;

select * from ND_CUST_MASTER;